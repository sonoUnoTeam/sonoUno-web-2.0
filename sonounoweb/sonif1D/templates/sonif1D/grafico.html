{% extends 'sonif1D/base.html' %}
{% load static %}
{% load custom_filters %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'sonif1D/config_styles.css' %}">
{% endblock %}

{% block content %}
<!-- Contenido de la pagina: LADO DERECHO -->
<div class="col-lg-4">
    <div class="card mb-4">
        {% include 'sonif1D/partials/config_dropdown.html' %}

        <!-- CADA CONFIGURACION VA ACA-->           
        <div class="card-body">
            <div class="row">
                <div class="text-center mb-3">
                    <i class="fas fa-chart-line fa-2x text-primary mb-2"></i>
                    <h4 class="text-primary">Configuración de Gráfico</h4>
                    <p class="text-muted small">Personaliza la apariencia de tu gráfico</p>
                </div>
                
                <form id="configForm" method="post" action="{% url 'sonif1D:grafico' %}">
                    {% csrf_token %}
                    
                    <!-- Configuraciones Generales -->
                    <div class="card border-light mb-3 config-section">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-cog"></i> Configuraciones Generales
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-3">
                                <label for="{{ form.name_grafic.id_for_label }}" class="form-label fw-bold">
                                    <i class="fas fa-heading"></i> {{ form.name_grafic.label }}
                                </label>
                                {{ form.name_grafic|add_class:"form-control" }}
                                {% if form.name_grafic.help_text %}
                                    <div class="form-text">{{ form.name_grafic.help_text }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="{{ form.name_eje_x.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-arrows-alt-h"></i> {{ form.name_eje_x.label }}
                                        </label>
                                        {{ form.name_eje_x|add_class:"form-control" }}
                                        {% if form.name_eje_x.help_text %}
                                            <div class="form-text">{{ form.name_eje_x.help_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="{{ form.name_eje_y.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-arrows-alt-v"></i> {{ form.name_eje_y.label }}
                                        </label>
                                        {{ form.name_eje_y|add_class:"form-control" }}
                                        {% if form.name_eje_y.help_text %}
                                            <div class="form-text">{{ form.name_eje_y.help_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Opciones de Visualización -->
                    <div class="card border-light mb-3 config-section">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-eye"></i> Opciones de Visualización
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.grilla|add_class:"form-check-input" }}
                                        <label class="form-check-label" for="{{ form.grilla.id_for_label }}">
                                            <i class="fas fa-th"></i> {{ form.grilla.label }}
                                        </label>
                                        {% if form.grilla.help_text %}
                                            <div class="form-text small">{{ form.grilla.help_text }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        {{ form.escala_grises|add_class:"form-check-input" }}
                                        <label class="form-check-label" for="{{ form.escala_grises.id_for_label }}">
                                            <i class="fas fa-adjust"></i> {{ form.escala_grises.label }}
                                        </label>
                                        {% if form.escala_grises.help_text %}
                                            <div class="form-text small">{{ form.escala_grises.help_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estilo de Línea -->
                    <div class="card border-light mb-3 config-section">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-paint-brush"></i> Estilo de Línea
                            </h6>
                        </div>
                        <div class="card-body">
                            {{ form.estilo_linea }}
                        </div>
                    </div>

                    <!-- Color de Línea -->
                    <div class="card border-light mb-3 config-section">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-palette"></i> Color de Línea
                            </h6>
                        </div>
                        <div class="card-body">
                            {{ form.color_linea }}
                        </div>
                    </div>

                    <!-- Campos ocultos para los datos en base64 -->
                    <input type="hidden" name="data_json" id="data_json">

                    <!-- Botón para guardar los cambios -->
                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-primary btn-lg" type="submit" onclick="setBase64Data()">
                            <i class="fas fa-save"></i> Aplicar Configuración
                        </button>
                        <small class="text-muted text-center">
                            Los cambios se aplicarán al gráfico actual
                        </small>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
  function setBase64Data() {
      document.getElementById('data_json').value = localStorage.getItem('data_json');
  }
</script>
{% endblock %}
